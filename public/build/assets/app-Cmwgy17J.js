class h{listenForWhisper(e,t){return this.listen(".client-"+e,t)}notification(e){return this.listen(".Illuminate\\Notifications\\Events\\BroadcastNotificationCreated",e)}stopListeningForWhisper(e,t){return this.stopListening(".client-"+e,t)}}class d{constructor(e){this.namespace=e}format(e){return[".","\\"].includes(e.charAt(0))?e.substring(1):(this.namespace&&(e=this.namespace+"."+e),e.replace(/\./g,"\\"))}setNamespace(e){this.namespace=e}}function k(s){try{new s}catch(e){if(e instanceof Error&&e.message.includes("is not a constructor"))return!1}return!0}class a extends h{constructor(e,t,n){super(),this.name=t,this.pusher=e,this.options=n,this.eventFormatter=new d(this.options.namespace),this.subscribe()}subscribe(){this.subscription=this.pusher.subscribe(this.name)}unsubscribe(){this.pusher.unsubscribe(this.name)}listen(e,t){return this.on(this.eventFormatter.format(e),t),this}listenToAll(e){return this.subscription.bind_global((t,n)=>{if(t.startsWith("pusher:"))return;let r=String(this.options.namespace??"").replace(/\./g,"\\"),i=t.startsWith(r)?t.substring(r.length+1):"."+t;e(i,n)}),this}stopListening(e,t){return t?this.subscription.unbind(this.eventFormatter.format(e),t):this.subscription.unbind(this.eventFormatter.format(e)),this}stopListeningToAll(e){return e?this.subscription.unbind_global(e):this.subscription.unbind_global(),this}subscribed(e){return this.on("pusher:subscription_succeeded",()=>{e()}),this}error(e){return this.on("pusher:subscription_error",t=>{e(t)}),this}on(e,t){return this.subscription.bind(e,t),this}}class b extends a{whisper(e,t){return this.pusher.channels.channels[this.name].trigger(`client-${e}`,t),this}}class E extends a{whisper(e,t){return this.pusher.channels.channels[this.name].trigger(`client-${e}`,t),this}}class C extends b{here(e){return this.on("pusher:subscription_succeeded",t=>{e(Object.keys(t.members).map(n=>t.members[n]))}),this}joining(e){return this.on("pusher:member_added",t=>{e(t.info)}),this}whisper(e,t){return this.pusher.channels.channels[this.name].trigger(`client-${e}`,t),this}leaving(e){return this.on("pusher:member_removed",t=>{e(t.info)}),this}}class f extends h{constructor(e,t,n){super(),this.events={},this.listeners={},this.name=t,this.socket=e,this.options=n,this.eventFormatter=new d(this.options.namespace),this.subscribe()}subscribe(){this.socket.emit("subscribe",{channel:this.name,auth:this.options.auth||{}})}unsubscribe(){this.unbind(),this.socket.emit("unsubscribe",{channel:this.name,auth:this.options.auth||{}})}listen(e,t){return this.on(this.eventFormatter.format(e),t),this}stopListening(e,t){return this.unbindEvent(this.eventFormatter.format(e),t),this}subscribed(e){return this.on("connect",t=>{e(t)}),this}error(e){return this}on(e,t){return this.listeners[e]=this.listeners[e]||[],this.events[e]||(this.events[e]=(n,r)=>{this.name===n&&this.listeners[e]&&this.listeners[e].forEach(i=>i(r))},this.socket.on(e,this.events[e])),this.listeners[e].push(t),this}unbind(){Object.keys(this.events).forEach(e=>{this.unbindEvent(e)})}unbindEvent(e,t){this.listeners[e]=this.listeners[e]||[],t&&(this.listeners[e]=this.listeners[e].filter(n=>n!==t)),(!t||this.listeners[e].length===0)&&(this.events[e]&&(this.socket.removeListener(e,this.events[e]),delete this.events[e]),delete this.listeners[e])}}class g extends f{whisper(e,t){return this.socket.emit("client event",{channel:this.name,event:`client-${e}`,data:t}),this}}class F extends g{here(e){return this.on("presence:subscribed",t=>{e(t.map(n=>n.user_info))}),this}joining(e){return this.on("presence:joining",t=>e(t.user_info)),this}whisper(e,t){return this.socket.emit("client event",{channel:this.name,event:`client-${e}`,data:t}),this}leaving(e){return this.on("presence:leaving",t=>e(t.user_info)),this}}class c extends h{subscribe(){}unsubscribe(){}listen(e,t){return this}listenToAll(e){return this}stopListening(e,t){return this}subscribed(e){return this}error(e){return this}on(e,t){return this}}class m extends c{whisper(e,t){return this}}class T extends c{whisper(e,t){return this}}class I extends m{here(e){return this}joining(e){return this}whisper(e,t){return this}leaving(e){return this}}const v=class w{constructor(e){this.setOptions(e),this.connect()}setOptions(e){this.options={...w._defaultOptions,...e,broadcaster:e.broadcaster};let t=this.csrfToken();t&&(this.options.auth.headers["X-CSRF-TOKEN"]=t,this.options.userAuthentication.headers["X-CSRF-TOKEN"]=t),t=this.options.bearerToken,t&&(this.options.auth.headers.Authorization="Bearer "+t,this.options.userAuthentication.headers.Authorization="Bearer "+t)}csrfToken(){var e,t;return typeof window<"u"&&(e=window.Laravel)!=null&&e.csrfToken?window.Laravel.csrfToken:this.options.csrfToken?this.options.csrfToken:typeof document<"u"&&typeof document.querySelector=="function"?((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"))??null:null}};v._defaultOptions={auth:{headers:{}},authEndpoint:"/broadcasting/auth",userAuthentication:{endpoint:"/broadcasting/user-auth",headers:{}},csrfToken:null,bearerToken:null,host:null,key:null,namespace:"App.Events"};let l=v;class o extends l{constructor(){super(...arguments),this.channels={}}connect(){if(typeof this.options.client<"u")this.pusher=this.options.client;else if(this.options.Pusher)this.pusher=new this.options.Pusher(this.options.key,this.options);else if(typeof window<"u"&&typeof window.Pusher<"u")this.pusher=new window.Pusher(this.options.key,this.options);else throw new Error("Pusher client not found. Should be globally available or passed via options.client")}signin(){this.pusher.signin()}listen(e,t,n){return this.channel(e).listen(t,n)}channel(e){return this.channels[e]||(this.channels[e]=new a(this.pusher,e,this.options)),this.channels[e]}privateChannel(e){return this.channels["private-"+e]||(this.channels["private-"+e]=new b(this.pusher,"private-"+e,this.options)),this.channels["private-"+e]}encryptedPrivateChannel(e){return this.channels["private-encrypted-"+e]||(this.channels["private-encrypted-"+e]=new E(this.pusher,"private-encrypted-"+e,this.options)),this.channels["private-encrypted-"+e]}presenceChannel(e){return this.channels["presence-"+e]||(this.channels["presence-"+e]=new C(this.pusher,"presence-"+e,this.options)),this.channels["presence-"+e]}leave(e){[e,"private-"+e,"private-encrypted-"+e,"presence-"+e].forEach(t=>{this.leaveChannel(t)})}leaveChannel(e){this.channels[e]&&(this.channels[e].unsubscribe(),delete this.channels[e])}socketId(){return this.pusher.connection.socket_id}disconnect(){this.pusher.disconnect()}}class S extends l{constructor(){super(...arguments),this.channels={}}connect(){let e=this.getSocketIO();this.socket=e(this.options.host??void 0,this.options),this.socket.io.on("reconnect",()=>{Object.values(this.channels).forEach(t=>{t.subscribe()})})}getSocketIO(){if(typeof this.options.client<"u")return this.options.client;if(typeof window<"u"&&typeof window.io<"u")return window.io;throw new Error("Socket.io client not found. Should be globally available or passed via options.client")}listen(e,t,n){return this.channel(e).listen(t,n)}channel(e){return this.channels[e]||(this.channels[e]=new f(this.socket,e,this.options)),this.channels[e]}privateChannel(e){return this.channels["private-"+e]||(this.channels["private-"+e]=new g(this.socket,"private-"+e,this.options)),this.channels["private-"+e]}presenceChannel(e){return this.channels["presence-"+e]||(this.channels["presence-"+e]=new F(this.socket,"presence-"+e,this.options)),this.channels["presence-"+e]}leave(e){[e,"private-"+e,"presence-"+e].forEach(t=>{this.leaveChannel(t)})}leaveChannel(e){this.channels[e]&&(this.channels[e].unsubscribe(),delete this.channels[e])}socketId(){return this.socket.id}disconnect(){this.socket.disconnect()}}class p extends l{constructor(){super(...arguments),this.channels={}}connect(){}listen(e,t,n){return new c}channel(e){return new c}privateChannel(e){return new m}encryptedPrivateChannel(e){return new T}presenceChannel(e){return new I}leave(e){}leaveChannel(e){}socketId(){return"fake-socket-id"}disconnect(){}}class A{constructor(e){this.options=e,this.connect(),this.options.withoutInterceptors||this.registerInterceptors()}channel(e){return this.connector.channel(e)}connect(){if(this.options.broadcaster==="reverb")this.connector=new o({...this.options,cluster:""});else if(this.options.broadcaster==="pusher")this.connector=new o(this.options);else if(this.options.broadcaster==="ably")this.connector=new o({...this.options,cluster:"",broadcaster:"pusher"});else if(this.options.broadcaster==="socket.io")this.connector=new S(this.options);else if(this.options.broadcaster==="null")this.connector=new p(this.options);else if(typeof this.options.broadcaster=="function"&&k(this.options.broadcaster))this.connector=new this.options.broadcaster(this.options);else throw new Error(`Broadcaster ${typeof this.options.broadcaster} ${String(this.options.broadcaster)} is not supported.`)}disconnect(){this.connector.disconnect()}join(e){return this.connector.presenceChannel(e)}leave(e){this.connector.leave(e)}leaveChannel(e){this.connector.leaveChannel(e)}leaveAllChannels(){for(const e in this.connector.channels)this.leaveChannel(e)}listen(e,t,n){return this.connector.listen(e,t,n)}private(e){return this.connector.privateChannel(e)}encryptedPrivate(e){if(this.connectorSupportsEncryptedPrivateChannels(this.connector))return this.connector.encryptedPrivateChannel(e);throw new Error(`Broadcaster ${typeof this.options.broadcaster} ${String(this.options.broadcaster)} does not support encrypted private channels.`)}connectorSupportsEncryptedPrivateChannels(e){return e instanceof o||e instanceof p}socketId(){return this.connector.socketId()}registerInterceptors(){typeof Vue<"u"&&Vue!=null&&Vue.http&&this.registerVueRequestInterceptor(),typeof axios=="function"&&this.registerAxiosRequestInterceptor(),typeof jQuery=="function"&&this.registerjQueryAjaxSetup(),typeof Turbo=="object"&&this.registerTurboRequestInterceptor()}registerVueRequestInterceptor(){Vue.http.interceptors.push((e,t)=>{this.socketId()&&e.headers.set("X-Socket-ID",this.socketId()),t()})}registerAxiosRequestInterceptor(){axios.interceptors.request.use(e=>(this.socketId()&&(e.headers["X-Socket-Id"]=this.socketId()),e))}registerjQueryAjaxSetup(){typeof jQuery.ajax<"u"&&jQuery.ajaxPrefilter((e,t,n)=>{this.socketId()&&n.setRequestHeader("X-Socket-Id",this.socketId())})}registerTurboRequestInterceptor(){document.addEventListener("turbo:before-fetch-request",e=>{e.detail.fetchOptions.headers["X-Socket-Id"]=this.socketId()})}}window.Echo=new A({broadcaster:"reverb",key:"mtucdvwop9qmtcrgeayw",wsHost:"departamentales.example.com",wsPort:"443",wssPort:"443",forceTLS:!0,enabledTransports:["ws","wss"]}),console.log("‚úÖ Echo configurado con Reverb");window.showToastNotification=function({title:s,body:e,iconColor:t,duration:n}){console.log("üîî Mostrando toast:",{title:s,body:e,iconColor:t,duration:n}),j({title:s,body:e,iconColor:t,duration:n})};function j({title:s,body:e,iconColor:t,duration:n}){console.log("üé® Creando toast HTML:",{title:s,body:e,iconColor:t});const r=B(),i=document.createElement("div"),x=L(t),u=$(t);i.style.cssText=`
        background: ${x};
        border: 1px solid ${u};
        border-left: 5px solid ${u};
        border-radius: 8px;
        padding: 16px 20px;
        margin-bottom: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        max-width: 400px;
        min-width: 300px;
        opacity: 0;
        transform: translateX(100%);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        pointer-events: auto;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    `,i.innerHTML=`
        <div style="display: flex; align-items: flex-start; gap: 12px;">
            <div style="flex-shrink: 0; margin-top: 2px;">
                ${q(t)}
            </div>
            <div style="flex: 1; min-width: 0;">
                <div style="font-weight: 600; color: #1F2937; margin-bottom: 4px; font-size: 15px; line-height: 1.3;">
                    ${s}
                </div>
                <div style="color: #4B5563; font-size: 14px; line-height: 1.4; word-wrap: break-word;">
                    ${e}
                </div>
            </div>
            <button onclick="this.parentElement.parentElement.style.opacity='0'; this.parentElement.parentElement.style.transform='translateX(100%)'; setTimeout(() => this.parentElement.parentElement.remove(), 300);" 
                    style="background: none; border: none; color: #9CA3AF; cursor: pointer; padding: 4px; font-size: 20px; line-height: 1; flex-shrink: 0; border-radius: 4px; transition: color 0.2s;"
                    onmouseover="this.style.color='#374151'"
                    onmouseout="this.style.color='#9CA3AF'">
                √ó
            </button>
        </div>
    `,r.appendChild(i),console.log("üìå Toast agregado al DOM"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{i.style.opacity="1",i.style.transform="translateX(0)",console.log("‚ú® Toast animado")})}),n&&n!=="persistent"&&n>0&&setTimeout(()=>{i.style.opacity="0",i.style.transform="translateX(100%)",setTimeout(()=>{i.parentElement&&(i.remove(),console.log("üóëÔ∏è Toast removido autom√°ticamente"))},300)},n)}function B(){let s=document.getElementById("custom-toast-container");return s||(s=document.createElement("div"),s.id="custom-toast-container",s.style.cssText=`
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 999999;
            pointer-events: none;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        `,document.body.appendChild(s),console.log("üì¶ Contenedor de toasts creado")),s}function L(s){return{success:"#F0FDF4",warning:"#FFFBEB",danger:"#FEF2F2",error:"#FEF2F2",info:"#EFF6FF"}[s]||"#F9FAFB"}function $(s){return{success:"#059669",warning:"#D97706",danger:"#DC2626",error:"#DC2626",info:"#2563EB"}[s]||"#6B7280"}function q(s){const e={success:'<div style="width: 20px; height: 20px; background: #059669; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: bold;">‚úì</div>',warning:'<div style="width: 20px; height: 20px; background: #D97706; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: bold;">!</div>',danger:'<div style="width: 20px; height: 20px; background: #DC2626; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: bold;">√ó</div>',error:'<div style="width: 20px; height: 20px; background: #DC2626; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: bold;">√ó</div>',info:'<div style="width: 20px; height: 20px; background: #2563EB; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: bold;">i</div>'};return e[s]||e.info}window.updateFilamentBadge=function(){window.Livewire&&(window.Livewire.dispatch("databaseNotificationsSent"),console.log("üîî Badge actualizado con databaseNotificationsSent"))};function O(){var s;return(s=document.querySelector('meta[name="user-id"]'))==null?void 0:s.getAttribute("content")}function y(){const s=O();if(!s||!window.Echo){console.error("‚ùå No se puede configurar Echo");return}console.log(`üîß Configurando Echo para usuario: ${s}`),window.Echo.channel(`notifications.${s}`).listen(".notification",e=>{console.log("üîî Notificaci√≥n de Echo recibida:",e),window.showToastNotification({title:e.title||"Nueva notificaci√≥n",body:e.body||"Tienes una notificaci√≥n pendiente",iconColor:e.iconColor||"info",duration:e.duration}),window.updateFilamentBadge()}).error(e=>{console.error("‚ùå Error en el canal privado de Echo:",e)})}document.addEventListener("DOMContentLoaded",()=>{setTimeout(y,500)});window.Livewire&&y();
